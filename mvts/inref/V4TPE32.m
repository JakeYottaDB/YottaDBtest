V4TPE32 ;IW-KO-YS-TS,VV4TP,MVTS V9.10;15/7/96;PART-94 Transaction
 ;COPYRIGHT MUMPS SYSTEMS LABORATORY 1994-1996
 ;
11 ;---1. TSTART ():SERIAL  ... TCOMMIT
 D ^V4TPS22 ;^VC^VD(1)VCVD(1)
 TSTART ():SERIAL
 F  Q:$$^V4GETS1
 D ^V4TPCHK1
 S ^VC(1,2)="^VC(1,2)",^VD="^VD"
 K  S VA(1)="VA(1)",VC="VC"
 TCOMMIT
 D ^V4TPCHK1
 L  H
 ;
12 ;---2. TSTART *:S  ... TRESTART ... TCOMMIT
 F  Q:$$^V4GETS2
 D ^V4TPS1 ;^VA^VB(1)VAVB(1)
 TSTART *:S
 IF $TRESTART G 3212
 D ^V4TPCHK2
 K
 TRESTART
 TCOMMIT
 D ^V4TPCHK2
 L  H
3212 D ^V4TPCHK2
 D ^V4TPS2 ;^va^vb(1)vavb(1)
 K
 TCOMMIT
 D ^V4TPCHK2
 L  H
 ;
13 ;---3. TSTART lname:(S)  ... TROLLBACK
 F  Q:$$^V4GETS3
 TSTART VC:(S)
 D ^V4TPS1 ;^VA^VB(1)VAVB(1)
 D ^V4TPCHK3
 TROLLBACK
 D ^V4TPCHK3
 L  H
 ;==========================================
21 ;---1. TSTART (lname,lname):S  ... TRESTART ... TROLLBACK
 TSTART (VC,VB):S
 F  Q:$$^V4GETS1
 IF $TRESTART G 3221
 D ^V4TPS22 ;^VC^VD(1)VCVD(1)
 K
 D ^V4TPCHK1
 TRESTART
 TCOMMIT
 D ^V4TPCHK1
 L  H
3221 D ^V4TPCHK1
 D ^V4TPS21 ;^VA^VB(1)VAVB(1)
 KILL  K ^VB
 D ^V4TPCHK1
 TCOMMIT
 D ^V4TPCHK1
 L  H
 ;
22 ;---2. TSTART (lname,lname):S  ... TROLLBACK
 F  Q:$$^V4GETS2
 TSTART (VA,VC):S
 D ^V4TPS22 ;^VC^VD(1)VCVD(1)
 D ^V4TPCHK2
 TROLLBACK
 D ^V4TPCHK2
 L  H
 ;
23 ;---3. TSTART lname:S  ... TRESTART ... TCOMMIT
 F  Q:$$^V4GETS3
 TSTART VB:S
 D ^V4TPS22 ;^VC^VD(1)VCVD(1)
 IF $TRESTART G 3223
 D ^V4TPS21 ;^VA^VB(1)VAVB(1)
 D ^V4TPCHK3
 TRESTART
 TCOMMIT
 D ^V4TPCHK3
 L  H
3223 D ^V4TPCHK3
 S ^VC="^VC" KILL
 D ^V4TPCHK3
 TCOMMIT
 D ^V4TPCHK3
 L  H
 ;
SUM S SUM=0 F I=1:1 S L=$T(+I) Q:L=""  F K=1:1:$L(L) S SUM=SUM+$A(L,K)
 Q
