V4TP22 ;IW-KO-YS-TS,VV4TP,MVTS V9.10;15/7/96;PART-94 Transaction
 ;COPYRIGHT MUMPS SYSTEMS LABORATORY 1994-1996
 ;
 W !!,"150---V4TP22: 2 Transactions tests  -2-"
 ;
 W !!,"TSTART with transparameters"
 W !,"   without a restart before TCOMMIT or TROLLBACK",!
 ;
1 S ^ABSN="40903",^ITEM="IV-903  1. TSTART :SERIAL  ... TCOMMIT!2. TSTART :S  ... TCOMMIT"
 S ^NEXT="2^V4TP22,V4TP23^VV4TP" D ^V4PRETP2
 JOB 11^V4TPE22::60 S WAIT=WAIT_$T
 JOB 12^V4TPE22::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VB(1)VAVB(1)10/#1^VA^VB(1)VAVB(1)00/#2^VA^VB(1)^VC^VD(1)VCVD(1)10/#2^VA^VB(1)^VC^VD(1)VCVD(1)00/*111/#M^VA^VB(1)^VC^VD(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
2 S ^ABSN="40904",^ITEM="IV-904  1. TSTART :SERIAL  ... TROLLBACK!2. TSTART lname:S  ... TCOMMIT"
 S ^NEXT="3^V4TP22,V4TP23^VV4TP" D ^V4PRETP2
 JOB 21^V4TPE22::60 S WAIT=WAIT_$T
 JOB 22^V4TPE22::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VB(1)VAVB(1)10/#1VAVB(1)00/#2^VC^VD(1)VCVD(1)10/#2^VC^VD(1)VCVD(1)00/*111/#M^VC^VD(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
3 S ^ABSN="40905",^ITEM="IV-905  1. TSTART (lname,lname,lname):SERIAL  ... TROLLBACK!2. TSTART *:SERIAL  ... TROLLBACK"
 S ^NEXT="4^V4TP22,V4TP23^VV4TP" D ^V4PRETP2
 JOB 31^V4TPE22::60 S WAIT=WAIT_$T
 JOB 32^V4TPE22::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VA(1)^VB(1)^VB(1,2)^VC(2)^VD(1,2)VAVA(1)VB(1)VB(1,2)VC(2)VD(1,2)10/#1^VA^VB(1)00/#2^VA^VB(1)10/#2^VA^VB(1)00/*111/#M^VA^VB(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
4 S ^ABSN="40906",^ITEM="IV-906  1. TSTART ():(SERIAL)  ... HALT!2. TSTART lname:SERIAL  ... TCOMMIT"
 S ^NEXT="5^V4TP22,V4TP23^VV4TP" D ^V4PRETP2
 JOB 41^V4TPE22::60 S WAIT=WAIT_$T
 JOB 42^V4TPE22::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^va(1)^VB(1)^vb(2)^vc(1,2)^vd(2)VAva(1)VB(1)vb(2)vc(1,2)vd(2)10/#2^VA^VB(1)^VC^VD(1)VCVD(1)10/#2^VA^VB(1)^VC^VD(1)VCVD(1)00/*111/#M^VA^VB(1)^VC^VD(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
5 S ^ABSN="40907",^ITEM="IV-907  1. TSTART ():SERIAL  ... TCOMMIT!2. non TP"
 S ^NEXT="6^V4TP22,V4TP23^VV4TP" D ^V4PRETP2
 JOB 51^V4TPE22::60 S WAIT=WAIT_$T
 JOB 52^V4TPE22::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VB(1)^vb(2)VAVB(1)10/#1^VA^VB(1)^vb(2)VAVB(1)00/#2^vb(2)00/#2^VA^VB(1)^vb(2)00/*111/#M^VA^VB(1)^vb(2)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
6 S ^ABSN="40908",^ITEM="IV-908  1. TSTART lname:SERIAL  ... TROLLBACK!2. non TP"
 S ^NEXT="V4TP23^VV4TP" D ^V4PRETP2
 JOB 61^V4TPE22::60 S WAIT=WAIT_$T
 JOB 62^V4TPE22::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VA^VB(1)^VB(1)^VC^VD(1)VAVAVB(1)VB(1)10/#1^VA^VB(1)^VC^VD(1)VAVAVB(1)VB(1)00/#2^VA^VB(1)^VC^VD(1)VCVD(1)00/#2^VA^VB(1)^VC^VD(1)VCVD(1)00/*111/#M^VA^VB(1)^VC^VD(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
END W !!,"End of 150 --- V4TP22",!
 Q
 ;
SUM S SUM=0 F I=1:1 S L=$T(+I) Q:L=""  F K=1:1:$L(L) S SUM=SUM+$A(L,K)
 Q
