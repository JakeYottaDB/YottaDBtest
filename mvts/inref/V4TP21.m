V4TP21 ;IW-KO-YS-TS,VV4TP,MVTS V9.10;15/7/96;PART-94 Transaction
 ;COPYRIGHT MUMPS SYSTEMS LABORATORY 1994-1996
 W !!,"2 Transactions tests"
 W !!,"149---V4TP21: 2 Transactions tests  -1-"
 W !!,"2 Transactions tests"
 w !,"    TSTART without argument",!!
 ;
1 S ^ABSN="40896",^ITEM="IV-896  1. TSTART ... TCOMMIT!2. TSTART ... TCOMMIT"
 S ^NEXT="2^V4TP21,V4TP22^VV4TP" D ^V4PRETP2
 JOB 11^V4TPE21::60 S WAIT=WAIT_$T
 JOB 12^V4TPE21::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VB(1)VAVB(1)10/#1^VA^VB(1)VAVB(1)00/#2^VA^VB(1)^VC^VD(1)VCVD(1)10/#2^VA^VB(1)^VC^VD(1)VCVD(1)00/*111/#M^VA^VB(1)^VC^VD(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
2 S ^ABSN="40897",^ITEM="IV-897  1. TSTART ... TCOMMIT!2. TSTART ... TROLLBACK"
 S ^NEXT="3^V4TP21,V4TP22^VV4TP" D ^V4PRETP2
 JOB 21^V4TPE21::60 S WAIT=WAIT_$T
 JOB 22^V4TPE21::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VB(1)VAVB(1)10/#1^VA^VB(1)VAVB(1)00/#2^VA^VB(1)^VC^VD(1)VCVD(1)10/#2^VA^VB(1)VCVD(1)00/*111/#M^VA^VB(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
3 S ^ABSN="40898",^ITEM="IV-898  1. TSTART ... TCOMMIT!2. TSTART ... HALT"
 S ^NEXT="4^V4TP21,V4TP22^VV4TP" D ^V4PRETP2
 JOB 31^V4TPE21::60 S WAIT=WAIT_$T
 JOB 32^V4TPE21::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VB(1)VAVB(1)10/#1^VA^VB(1)VAVB(1)00/#2^VA^VB(1)^VC^VD(1)VCVD(1)10/*111/#M^VA^VB(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
4 S ^ABSN="40899",^ITEM="IV-899  1. TSTART ... TCOMMIT!2. non TP"
 S ^NEXT="5^V4TP21,V4TP22^VV4TP" D ^V4PRETP2
 JOB 41^V4TPE21::60 S WAIT=WAIT_$T
 JOB 42^V4TPE21::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VB(1)^VC^VD(1)VAVB(1)10/#1^VA^VB(1)^VC^VD(1)VAVB(1)00/#2^VC^VD(1)VCVD(1)00/#2^VA^VB(1)^VC^VD(1)VCVD(1)00/*111/#M^VA^VB(1)^VC^VD(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
5 S ^ABSN="40900",^ITEM="IV-900  1. TSTART ... TROLLBACK!2. non TP"
 S ^NEXT="6^V4TP21,V4TP22^VV4TP" D ^V4PRETP2
 JOB 51^V4TPE21::60 S WAIT=WAIT_$T
 JOB 52^V4TPE21::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VA^VB(1)^VC^VD(1)VAVB(1)10/#1^VC^VD(1)VAVB(1)00/#2^VC^VD(1)VCVD(1)00/*111/#M^VC^VD(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
6 S ^ABSN="40901",^ITEM="IV-901  1. non TP!2. TSTART ... TCOMMIT"
 S ^NEXT="7^V4TP21,V4TP22^VV4TP" D ^V4PRETP2
 JOB 61^V4TPE21::60 S WAIT=WAIT_$T
 JOB 62^V4TPE21::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VC^VD(1)VCVD(1)00/#1^VC^VD(1)VCVD(1)00/#2^VA^VB(1)^VC^VD(1)VAVB(1)10/#2^VA^VB(1)^VC^VD(1)VAVB(1)00/*111/#M^VA^VB(1)^VC^VD(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
7 S ^ABSN="40902",^ITEM="IV-902  1. non TP!2. TSTART ... TROLLBACK"
 S ^NEXT="V4TP22^VV4TP" D ^V4PRETP2
 JOB 71^V4TPE21::60 S WAIT=WAIT_$T
 JOB 72^V4TPE21::60 S WAIT=WAIT_$T
 LOCK -^V(1) HANG 1 LOCK -^V(2) HANG 1
 L  F  Q:$$^V4GETSM
 S ^VCORR="#1^VC^VD(1)VCVD(1)00/#1^VC^VD(1)VCVD(1)00/#2^VA^VB(1)^VC^VD(1)VAVB(1)10/#2^VC^VD(1)VAVB(1)00/*111/#M^VC^VD(1)00/"
 D ^V4TPCHKM D ^V4GETCOM D ^VEXAMINE
 ;
END W !!,"End of 149 --- V4TP21",!
 Q
 ;
SUM S SUM=0 F I=1:1 S L=$T(+I) Q:L=""  F K=1:1:$L(L) S SUM=SUM+$A(L,K)
 Q
